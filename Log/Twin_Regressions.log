-----------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/damiancclarke/investigacion/Activa/Twins/Log/Twin_Regressions.log
  log type:  text
 opened on:  21 May 2014, 18:30:14

. use "$Data/DHS_twins", clear

. 
. drop if twinfamily>2
(6723 observations deleted)

. keep if _merge==3
(2889332 observations deleted)

. replace bmi=. if bmi>50
(39849 real changes made, 39849 to missing)

. replace height=. if height>240
(32758 real changes made, 32758 to missing)

. replace height=. if height<80
(2134 real changes made, 2134 to missing)

. replace educ=. if age<6
(1380644 real changes made, 1380644 to missing)

. replace educ=. if educ>25
(0 real changes made)

. replace educf=. if educf>25
(1422 real changes made, 1422 to missing)

. replace birthspacing=. if birthspacing<8|birthspacing==999
(507 real changes made, 507 to missing)

. 
. tab _cou, gen(_country)

   country (numeric code) |      Freq.     Percent        Cum.
--------------------------+-----------------------------------
                  Albania |      9,815        0.26        0.26
                  Armenia |     23,064        0.61        0.86
               Azerbaijan |     10,052        0.26        1.13
               Bangladesh |    137,762        3.62        4.75
                    Benin |     48,825        1.28        6.04
                  Bolivia |     89,613        2.36        8.40
                   Brazil |     26,230        0.69        9.09
             Burkina-Faso |     77,794        2.05       11.13
                  Burundi |     17,030        0.45       11.58
                 Cambodia |     77,554        2.04       13.62
                 Cameroon |     43,514        1.14       14.76
 Central-African-Republic |      8,208        0.22       14.98
                     Chad |     26,257        0.69       15.67
                 Colombia |    151,302        3.98       19.65
                  Comoros |      4,322        0.11       19.77
        Congo-Brazzaville |     23,867        0.63       20.39
Congo-Democratic-Republic |     17,566        0.46       20.86
            Cote-d-Ivoire |     35,441        0.93       21.79
       Dominican-Republic |     82,483        2.17       23.96
                    Egypt |    188,321        4.95       28.91
                 Ethiopia |     76,245        2.01       30.92
                    Gabon |     18,717        0.49       31.41
                    Ghana |     29,012        0.76       32.17
                Guatemala |     26,159        0.69       32.86
                   Guinea |     25,721        0.68       33.54
                   Guyana |      9,725        0.26       33.79
                    Haiti |     51,606        1.36       35.15
                 Honduras |     63,970        1.68       36.83
                    India |    479,419       12.61       49.45
                Indonesia |    350,158        9.21       58.66
                   Jordan |    103,528        2.72       61.38
               Kazakhstan |     10,878        0.29       61.67
                    Kenya |     40,503        1.07       62.73
          Kyrgyz-Republic |      6,244        0.16       62.90
                  Lesotho |     19,463        0.51       63.41
                  Liberia |      9,751        0.26       63.66
               Madagascar |     65,688        1.73       65.39
                   Malawi |     93,838        2.47       67.86
                 Maldives |     11,226        0.30       68.16
                     Mali |     71,572        1.88       70.04
                  Moldova |      7,132        0.19       70.23
                  Morocco |     38,387        1.01       71.24
               Mozambique |     51,001        1.34       72.58
                  Namibia |     21,713        0.57       73.15
                    Nepal |     61,709        1.62       74.77
                Nicaragua |     45,442        1.20       75.97
                    Niger |     41,768        1.10       77.07
                  Nigeria |     91,428        2.41       79.47
                 Pakistan |     49,004        1.29       80.76
                 Paraguay |      9,756        0.26       81.02
                     Peru |    108,175        2.85       83.86
              Philippines |     92,201        2.43       86.29
                   Rwanda |     71,594        1.88       88.17
    Sao-Tome-and-Principe |      4,524        0.12       88.29
                  Senegal |     70,462        1.85       90.15
             Sierra-Leone |     10,353        0.27       90.42
             South-Africa |     12,790        0.34       90.75
                Swaziland |      5,762        0.15       90.91
                 Tanzania |     94,414        2.48       93.39
                     Togo |     11,299        0.30       93.69
                   Turkey |     37,557        0.99       94.67
                   Uganda |     52,006        1.37       96.04
                  Ukraine |      6,031        0.16       96.20
               Uzbekistan |      7,905        0.21       96.41
                  Vietnam |     25,329        0.67       97.08
                    Yemen |     20,500        0.54       97.62
                   Zambia |     51,358        1.35       98.97
                 Zimbabwe |     39,299        1.03      100.00
--------------------------+-----------------------------------
                    Total |  3,801,342      100.00

. tab year_birth, gen(_yb)

   Mother's |
    year of |
      birth |      Freq.     Percent        Cum.
------------+-----------------------------------
       1936 |          2        0.00        0.00
       1937 |        144        0.00        0.00
       1938 |         96        0.00        0.01
       1939 |        132        0.00        0.01
       1940 |        461        0.01        0.02
       1941 |      2,203        0.06        0.08
       1942 |      5,550        0.15        0.23
       1943 |      9,056        0.24        0.46
       1944 |     11,585        0.30        0.77
       1945 |     17,252        0.45        1.22
       1946 |     20,100        0.53        1.75
       1947 |     24,308        0.64        2.39
       1948 |     28,805        0.76        3.15
       1949 |     34,267        0.90        4.05
       1950 |     45,554        1.20        5.25
       1951 |     44,350        1.17        6.42
       1952 |     57,501        1.51        7.93
       1953 |     58,759        1.55        9.47
       1954 |     69,154        1.82       11.29
       1955 |     77,169        2.03       13.32
       1956 |     85,667        2.25       15.58
       1957 |     94,346        2.48       18.06
       1958 |    104,722        2.75       20.81
       1959 |    108,858        2.86       23.68
       1960 |    132,520        3.49       27.16
       1961 |    116,971        3.08       30.24
       1962 |    139,941        3.68       33.92
       1963 |    138,244        3.64       37.56
       1964 |    140,983        3.71       41.27
       1965 |    146,485        3.85       45.12
       1966 |    138,817        3.65       48.77
       1967 |    133,411        3.51       52.28
       1968 |    144,797        3.81       56.09
       1969 |    131,742        3.47       59.56
       1970 |    147,016        3.87       63.42
       1971 |    122,022        3.21       66.63
       1972 |    129,996        3.42       70.05
       1973 |    119,705        3.15       73.20
       1974 |    109,105        2.87       76.07
       1975 |    110,462        2.91       78.98
       1976 |    100,544        2.64       81.62
       1977 |     89,131        2.34       83.97
       1978 |     88,061        2.32       86.29
       1979 |     76,926        2.02       88.31
       1980 |     80,032        2.11       90.41
       1981 |     61,870        1.63       92.04
       1982 |     59,639        1.57       93.61
       1983 |     51,268        1.35       94.96
       1984 |     42,245        1.11       96.07
       1985 |     36,593        0.96       97.03
       1986 |     30,525        0.80       97.84
       1987 |     21,993        0.58       98.41
       1988 |     19,438        0.51       98.93
       1989 |     12,719        0.33       99.26
       1990 |     10,861        0.29       99.55
       1991 |      7,079        0.19       99.73
       1992 |      4,987        0.13       99.86
       1993 |      2,772        0.07       99.94
       1994 |      1,472        0.04       99.98
       1995 |        665        0.02       99.99
       1996 |        240        0.01      100.00
       1997 |         24        0.00      100.00
------------+-----------------------------------
      Total |  3,801,342      100.00

. tab age, gen(_age)

Child's age |
   in years |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    275,016        7.23        7.23
          1 |    245,515        6.46       13.69
          2 |    232,155        6.11       19.80
          3 |    228,410        6.01       25.81
          4 |    220,860        5.81       31.62
          5 |    210,710        5.54       37.16
          6 |    225,267        5.93       43.09
          7 |    204,541        5.38       48.47
          8 |    201,440        5.30       53.77
          9 |    177,132        4.66       58.43
         10 |    195,036        5.13       63.56
         11 |    156,533        4.12       67.68
         12 |    175,649        4.62       72.30
         13 |    153,224        4.03       76.33
         14 |    144,665        3.81       80.13
         15 |    128,153        3.37       83.50
         16 |    114,507        3.01       86.52
         17 |     95,749        2.52       89.04
         18 |     91,777        2.41       91.45
         19 |     63,914        1.68       93.13
         20 |     64,965        1.71       94.84
         21 |     42,704        1.12       95.96
         22 |     40,566        1.07       97.03
         23 |     29,234        0.77       97.80
         24 |     22,920        0.60       98.40
         25 |     20,815        0.55       98.95
         26 |     12,695        0.33       99.28
         27 |      9,184        0.24       99.53
         28 |      7,031        0.18       99.71
         29 |      3,705        0.10       99.81
         30 |      3,920        0.10       99.91
         31 |      1,315        0.03       99.95
         32 |      1,032        0.03       99.97
         33 |        463        0.01       99.99
         34 |        245        0.01       99.99
         35 |        178        0.00      100.00
         36 |         58        0.00      100.00
         37 |         27        0.00      100.00
         38 |         13        0.00      100.00
         39 |          5        0.00      100.00
         40 |          8        0.00      100.00
         41 |          2        0.00      100.00
         42 |          3        0.00      100.00
         44 |          1        0.00      100.00
------------+-----------------------------------
      Total |  3,801,342      100.00

. tab contracep_intent, gen(_contracep)

contraceptive use and intention |      Freq.     Percent        Cum.
--------------------------------+-----------------------------------
            using modern method |  1,373,985       36.49       36.49
       using traditional method |    310,740        8.25       44.74
non-user - intends to use later |    912,583       24.24       68.98
         does not intend to use |  1,168,160       31.02      100.00
                  never had sex |          1        0.00      100.00
--------------------------------+-----------------------------------
                          Total |  3,765,469      100.00

. tab bord, gen(_bord)

    Child's |
birth order |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |    971,887       25.57       25.57
          2 |    837,648       22.04       47.60
          3 |    632,402       16.64       64.24
          4 |    451,590       11.88       76.12
          5 |    319,188        8.40       84.52
          6 |    223,078        5.87       90.38
          7 |    150,112        3.95       94.33
          8 |     96,682        2.54       96.88
          9 |     57,940        1.52       98.40
         10 |     32,505        0.86       99.26
         11 |     16,204        0.43       99.68
         12 |      7,411        0.19       99.88
         13 |      2,811        0.07       99.95
         14 |      1,137        0.03       99.98
         15 |        465        0.01       99.99
         16 |        188        0.00      100.00
         17 |         58        0.00      100.00
         18 |         19        0.00      100.00
         19 |         10        0.00      100.00
         20 |          6        0.00      100.00
         21 |          1        0.00      100.00
------------+-----------------------------------
      Total |  3,801,342      100.00

. local base malec _country* _yb* _age* _contracep* `add'

. 
. *******************************************************************************
. *** (2) Summary Stats
. *******************************************************************************
. if `sumstats'==1 {
.         
.         if c(os)=="Windows" local format png
.         else if c(os)=="Unix" local format eps
.         ***************************************************************************
.         *** (2a) Tables
.         ***************************************************************************
.         * (A) By twins
.         local opts cells("count mean sd min max")
. 
.         gen cat="Low Inc, Singleton" if twind==0 & inc_status=="L"
.         replace cat="Low Inc, Twin" if twind==1 & inc_status=="L"
.         replace cat="Mid Inc, Single" if twind==0 & inc_status!="L"
.         replace cat="Mid Inc, Twin" if twind==1 & inc_status!="L"
.         encode cat, gen(catnum)
.         
.         local numkids "Number of Children"
.         local nummothers "Number of Mothers"
.         local numcountry "Number of Countries"
.         foreach num of numlist 1(1)4 {
  2.                 cap drop count
  3.                 gen count = 1
  4.                 replace count=. if catnum!=`num'
  5.                 foreach var of local sumstats {
  6.                         replace count=. if `var'==.
  7.                 }
  8.                 count if count==1
  9.                 local kk = "`: display %9.0fc r(N)'"
 10. 
.                 local numkids "`numkids' `sep'" "`kk'"
 11. 
.                 bys id: gen n=_n
 12.                 count if count==1&n==1
 13.                 local mm = "`: display %9.0fc r(N)'"
 14.                 local nummothers "`nummothers' `sep'" "`mm'"
 15.                 drop n
 16. 
.                 bys _cou: gen n=_n
 17.                 count if count==1&n==1
 18.                 if `num'==1|`num'==3 {
 19.                         local numcountry "`numcountry' `sep' `r(N)'`sep'`r(N)' "
 20.                 }
 21.                 drop n
 22.         }
. 
.         count
.         local kidcount = "`: display %9.0fc r(N)'"
.         sum twind
.         scalar at = "`: display %7.4f r(mean)'"
.         scalar as = "`: display %7.4f r(sd)'"   
.         sum twind if inc_status=="L"
.         scalar lt = "`: display %7.4f r(mean)'"
.         scalar ls = "`: display %7.4f r(sd)'"
.         sum twind if inc_status!="L"
.         scalar mt = "`: display %7.4f r(mean)'"
.         scalar ms = "`: display %7.4f r(sd)'"
. 
.         sum bord if twind==1
.         scalar abm = "`: display %7.3f r(mean)'"
.         scalar abs = "`: display %7.3f r(sd)'"
.         sum bord if twind==1 & inc_status=="L"
.         scalar lbm = "`: display %7.3f r(mean)'"
.         scalar lbs = "`: display %7.3f r(sd)'"
.         sum bord if twind==1 &  inc_status!="L"
.         scalar mbm = "`: display %7.3f r(mean)'"
.         scalar mbs = "`: display %7.3f r(sd)'"
. 
. 
.         preserve
.         gen exceedfam=idealfam==1
.         collapse $sumstatsM, by(id cat)
.         count
.         local mothercount = "`: display %9.0fc r(N)'"
. 
.         file open resfile using "$Tables/Summary/Count.txt", write replace
.         file write resfile "`numcountry' & 67 \\" _n
.         file write resfile "`numkids' & `kidcount' \\" _n
.         file write resfile "`nummothers' & `mothercount' \\" _n
.         file write resfile "Fraction Twin & \multicolumn{2}{c}{ `=scalar(lt)'" ///
>           "}& \multicolumn{2}{c}{ `=scalar(mt)' } & `=scalar(at)'\\" _n
.         file write resfile "& \multicolumn{2}{c}{(`=scalar(ls)')" ///
>           "}& \multicolumn{2}{c}{(`=scalar(ms)')} & (`=scalar(as)')\\" _n
.         file write resfile "Birth Order Twin & \multicolumn{2}{c}{ `=scalar(lbm)'" ///
>           "}& \multicolumn{2}{c}{ `=scalar(mbm)' }& `=scalar(abm)'\\" _n
.         file write resfile "& \multicolumn{2}{c}{(`=scalar(lbs)')" ///
>           "}& \multicolumn{2}{c}{(`=scalar(mbs)')}& (`=scalar(abs)')\\" _n
.         file write resfile "`mothercount'"
.         file close resfile
.         
.         estpost tabstat $sumstatsM, by(cat) statistics(mean sd) listwise ///
>          columns(statistics)
.         esttab using "$Tables/Summary/`Sum'.txt", replace main(mean) aux(sd) /*
>         */ nostar unstack noobs nonote nomtitle nonumber
.         restore
. 
.         preserve
.         decode _cou, gen(WBcountry)
.         gen colvar=inc_status=="L"
.         collapse colvar, by(WBcountry _year)
.         gen income="Low" if colvar==1
.         replace income="Middle" if colvar==0
.         drop colvar
.         order WBcountry income _year
.         sort WBc _year
.         outsheet using "$Tables/Summary/Countries.csv", delimit(;) nonames replace
.         restore
. 
.         preserve
.         use "$Data/DHS_twins.dta", clear
.         gen cat="Low Inc, Singleton" if twind==0 & inc_status=="L"
.         replace cat="Low Inc, Twin" if twind==1 & inc_status=="L"
.         replace cat="Mid Inc, Single" if twind==0 & inc_status!="L"
.         replace cat="Mid Inc, Twin" if twind==1 & inc_status!="L"
.         encode cat, gen(catnum)
.         estpost tabstat $sumstatsC, by(cat) statistics(mean sd) listwise ///
>          columns(statistics)
.         esttab using "$Tables/Summary/`SumC'.txt", replace main(mean) aux(sd) /*
>         */ nostar unstack noobs nonote nomtitle nonumber
.         clear
.         restore
.         ***************************************************************************
.         *** (2b) Graphical
.         *** graph 1: total births by family type (twins vs non-twins)
.         *** graph 2: total births by family type for families who exceed desired
.         *** graph 3: Proportion of twins by birth order
.         *** graph 4: Desired family size
.         *** graphs 5-7: Desired family size by mother's characteristics
.         ***************************************************************************
.         if `graphs'==1 {
. 
.         twoway kdensity fert if twinfamily>0&twinfamily!=., lpattern(dash) bw(2) || ///
>           kdensity fert if twinfamily==0, bw(2) scheme(s1color) ytitle("Density") ///
>           legend(label(1 "Twin Family") label(2 "Singleton Family")) ///
>           title("Total births by Family Type") xtitle("total children ever born") 
.         graph save "$Graphs/`famsize'", replace
.         graph export "$Graphs/`famsize'.`format'", as(`format') replace
. 
. 
.         twoway kdensity fert if twinfamily>0&twinfamily!=. & fert > idealnumkids, ///
>           bw(2) lpattern(dash) || kdensity fert if twinfamily==0 & ///
>           fert > idealnumkids & twin_bord >= idealnumkids, bw(2) scheme(s1color) ///
>           legend(label(1 "Twin Family") label(2 "Singleton Family")) ///
>           ytitle("Density") title("Total births by Family Type") ///
>           xtitle("total children ever born") ///
>           subtitle("For families who exceed desired family size")
.         graph save "$Graphs/`famsize_e'", replace
.         graph export "$Graphs/`famsize_e'.`format'", as(`format') replace
. 
.         
.         local note1 "Single births are 1-frac(twins). "
.         local note2 "Total fraction of twins is represented by the solid line."
.         local gnote "`note1' `note2'"
.         sum twind
.         local twinave=r(mean)   
.         preserve
.         collapse twind [pw=sweight], by(bord)
.         gen twinave=`twinave'   
.         line twind bord if bord<11, lpattern(dash) title("Twinning by birth order") ///
>           ytitle("Fraction twins") xtitle("Birth Order") yline(0.0189) ///
>           note(`gnote') scheme(s1color)
.         graph save "$Graphs/`twinbord'", replace
.         graph export "$Graphs/`twinbord'.`format'", as(`format') replace
. 
.         twoway bar twind bord if bord<11 || ///
>         line twinave bord if bord<11, title("Twinning by birth order") ///
>           ytitle("Fraction twins") xtitle("Birth Order")  ///
>           note(`gnote') scheme(s1color)
.         graph save "$Graphs/`twinbord'_hist", replace
.         graph export "$Graphs/`twinbord'_hist.`format'", as(`format') replace
.         restore
. 
.         
.         local n1 "Total sample of families is 1,586,899.  2.61% of families report "
.         local n2 "'up to god', and 4.39% provide"
.         local n3 "a non-numeric response. These are omitted here."      
.         preserve
.         collapse idealnumkids [pw=sweight], by(id)
.         gen idealnum=idealnumkids if idealnumkids<=9
.         replace idealnum=9 if idealnumkids>10 & idealnumkids<=30
.         lab def n 0 "0" 1 "1" 2 "2" 3 "3" 4 "4" 5 "5" 6 "6" 7 "7" 8 "8" 9 "9+"
.         lab val idealnum n
.         hist idealnum,  note("`n1' `n2'" "`n3'") frac scheme(s1color) ///
>           xtitle("Ideal Family Size") title("Self Reported Ideal Family Size") ///
>           xla(0/9, valuelabel) bcolor(navy)
.         graph save "$Graphs/`idealfam'", replace
.         graph export "$Graphs/`idealfam'.`format'", as(`format') replace
.         restore
. 
.         foreach c of varlist /*agemay agefirstbirth*/ fert {
  2.                 preserve
  3.                 if `"`c'"'=="agemay" {
  4.                         local cond agemay>=15&agemay<=45
  5.                         local char "Age of mother at time of question"
  6.                 }
  7.                 else if `"`c'"'=="agefirstbirth" {
  8.                         local cond agefirstbirth>=15&agefirstbirth<45
  9.                         local char "Age of Mother at First birth"
 10.                 }
 11.                 else if `"`c'"'=="fert"{
 12.                         local cond fert<=10
 13.                         local char "Total births at time of question"
 14.                 }
 15.                 bys id: gen num=_n
 16.                 keep if num==1
 17.                 collapse idealnumkids [pw=sweight], by(`c')
 18.                 if `"`c'"'=="fert" {
 19.                         sort idealnumkids
 20.                         gen vert=fert
 21.                         twoway line idealnumkids `c' if `cond' || line vert `c' if `cond', ///
>                         lpattern(dash) lcolor(black) title("Ideal Family Size by `char'")  ///
>                         scheme(s1color) ytitle("Average Desired Family Size") ///
>                         legend(label(1 "Ideal Number of Kids") label(2 "45 degrees")) ///         
>                         xtitle("`char'")
 22.                 }               
 23.                 else {  
 24.                         line idealnumkids `c' if `cond', title("Ideal Family Size by `char'") ///
>                         scheme(s1color) xtitle("`char'") ytitle("Average Desired Family Size")
 25.                 }
 26.            graph save "$Graphs/idealfam_`c'", replace
 27.            graph export "$Graphs/idealfam_`c'.`format'", as(`format') replace
 28.                 restore
 29.         }
. 
.         local ii=1
.         foreach condition in income=="low" income=="mid" income=="low"|income=="mid" {
  2.                 if `ii'==1 local name "Low"
  3.                 else if `ii'==2 local name "Middle"
  4.                 else if `ii'==3 local name "All"
  5.                 preserve
  6.                 gen attend1=1 if attendance==1|attendance==2
  7.                 replace attend1=0 if attendance==0
  8.                 gen attend2=1 if attendance==2
  9.                 replace attend2=0 if attendance==1|attendance==0
 10.                 keep `cond'&`condition'
 11.                 collapse attend1 attend2 educ, by(age)
 12.                 drop if age>19
 13.                 gen theoretical=age-5
 14.                 twoway line educ age if age>5 || line theoretical age if age>5, /*
>                 */ title("Education by Age Group") subtitle("`name' Income") /*
>                 */ xtitle("Child's age in years") ytitle("Education") scheme(s1color)
 15.                 graph export "$Graphs/EducAge`name'.eps", as(eps) replace
 16.                 twoway bar attend1 age if age>5, scheme(s1color) bcolor(navy) /*
>                 */ title("Attendance by Age Group") subtitle("`name' Income") /*
>                 */ xtitle("Child's age in years") ytitle("Proportion Attending") /*
>                 */ note("Attendance refers to children who report always or sometimes attending")
 17.                 graph export "$Graphs/Attend1`name'.eps", as(eps) replace
 18.                 twoway bar attend2 age if age>5, scheme(s1color) bcolor(navy) /*
>                 */ title("Attendance by Age Group") subtitle("`name' Income") /*
>                 */ xtitle("Child's age in years") ytitle("Proportion Always Attending") /*
>                 */ note("Attendance refers to children who report always attending")
 19.                 graph export "$Graphs/Attend2`name'.eps", as(eps) replace
 20.                 restore
 21.                 local ++ii
 22.         }       
.         }
. }

. 
. if `sumstats2'==1 {
. 
.         *****************************************************************************
.         *** (2d) Descriptive of desired
.         *****************************************************************************
.         estpost tab idealfam `cond'
.         esttab using "$Tables/Summary/Ideal.xls", cells("b pct") replace
.         estpost tab idealfam `cond'&twinfam==0
.         esttab using "$Tables/Summary/Ideal.xls", cells("b pct") append
.         estpost tab idealfam `cond'&twinfam>=1
.         esttab using "$Tables/Summary/Ideal.xls", cells("b pct") append
.         foreach num in `gplus' {
  2.                 estpost tab idealnumkids `cond'&`num'_plus==1&twin_`num'_fam==0
  3.                 esttab using "$Tables/Summary/Ideal.xls", cells("b pct") append
  4. 
.                 estpost tab idealnumkids `cond'&`num'_plus==1&twin_`num'_fam==1
  5.                 esttab using "$Tables/Summary/Ideal.xls", cells("b pct") append
  6.         }
. 
.         local t=2       
.         foreach n in `gplus' {
  2.                 gen threshold`n'=(twin_`n'_fam==1 & idealnumkids==`t')
  3.                 replace threshold`n'=. if twin_`n'_fam==0
  4.                 local ++t
  5.         }
.         gen threshold2_5=1 if thresholdtwo==1|thresholdthree==1|thresholdfour==1|/*
>         */thresholdfive==1
.         replace threshold2_5=0 if thresholdtwo==0|thresholdthree==0|/*
>         */thresholdfour==0|thresholdfive==0
. 
.         preserve
. 
.         gen inclevel="L" if inc_status=="L"
.         replace inclevel="M" if inc_status=="LM"|inc_status=="UM"
.         keep threshold* id inclevel
.         collapse threshold*, by(id inclevel)
.         
.         estpost tabstat threshold2_5 thresholdt* thresholdfour thresholdfive, /*
>         */ by(inclevel) statistics(mean sd count) columns(statistics)
.         mat counts = e(count)
. 
.         esttab using "$Tables/Summary/Threshold.txt", replace main(mean) aux(sd) /*
>         */ nostar unstack nonote nomtitle nonumber
.         esttab matrix(counts) using "$Tables/Summary/Threshold.txt", append
.         
.         restore
.         
.    *****************************************************************************
.         *** (2e) Descriptive of maternal health
.         *****************************************************************************   
.         if `graphs2'==1 {
.                 preserve
.                 collapse height weightk bmi [pw=sweight] `cond', by(id)
.                 hist weightk if weightk>30&weightk<200, frac scheme(s1color) ///
>                   xtitle("Weight in kg") title("Mother's Weight at time of Survey")
.                 graph export "$Graphs/MotherWeight.eps", as(eps) replace
.                 hist height, frac scheme(s1color) ///
>                   xtitle("Height in cm") title("Mother's Height at time of Survey")
.                 graph export "$Graphs/MotherHeight.eps", as(eps) replace
.                 hist bmi, frac scheme(s1color) ///
>                   xtitle("BMI") title("Mother's BMI at time of Survey") ///
>                   note("BMI is experessed as weight in kg squared/height in km")
.                 graph export "$Graphs/MotherBMI.eps", as(eps) replace
.                 restore
.         }       
. 
.         gen lowheight=height<157.48
.         replace lowheight=. if height==.
.         gen lowweight=bmi<18.5
.         replace lowweight=. if bmi==.
.         
.         estpost tab lowheight `cond'
.         esttab using "$Tables/Summary/Health.xls", cells("b pct") replace
.         estpost tab lowweight `cond'
.         esttab using "$Tables/Summary/Health.xls", cells("b pct") append
. }

. 
. if `trends'==1 {
.         foreach inc in all low mid {
  2.                 if "`inc'"=="all" local cex
  3.                 else if "`inc'"=="low"|"`inc'"=="mid" local cex &income=="`inc'"        
  4.                 **************************************************************************
.                 *** (2f) Trends in education/fertility
.                 **************************************************************************
.                 preserve
  5.                 keep `cond'&age>15`cex'
  6.                 collapse educ `w', by(child_yob)
  7.                 sort child_yob
  8.                 twoway line educ child_yob, /* 
>                 */ title("Average years of Education by Birth Cohort") scheme(s1color) /*
>                 */ xtitle("DHS Birth Cohort") ytitle("Years of Education")
  9.                 graph export "$Graphs/eductrend_kids_`inc'.eps", as(eps) replace
 10.                 restore
 11. 
.                 preserve
 12.                 keep `cond'`cex'
 13.                 bys id: gen keepcrit=_n
 14.                 keep if keepcrit==1
 15.                 collapse educf `w', by(year_birth)
 16.                 sort year_birth
 17.                 twoway line educf year_birth if year_birth>=1940&year_birth<1997, /* 
>                 */ title("Average years of Education by Birth Cohort") scheme(s1color) /*
>                 */ xtitle("DHS Birth Cohort") ytitle("Years of Education")
 18.                 graph export "$Graphs/eductrend_`inc'.eps", as(eps) replace
 19.                 restore
 20. 
.                 
.                 foreach aa of numlist 0 35 {
 21.                         if `aa'==0 local title "Fertility (All women)"
 22.                         if `aa'==35 local title "Fertility (Women aged 35+)"
 23.                         preserve
 24.                         keep `cond'&agemay>`aa'`cex'
 25.                         bys id: gen keepcrit=_n
 26.                         keep if keepcrit==1
 27.                         collapse fert idealnumkids `w', by(year_birth)
 28.                         sort year_birth
 29.                         twoway line fert year_bi, lpattern(dash) || line idealnumkids year_birth, /*
>                         */ scheme(s1color) legend(label(1 "Fertility per Woman") /*
>                         */ label(2 "Desired Fertility")) title(`title') ytitle("Births per Woman")
 30.                         graph export "$Graphs/ferttrend_`aa'_`inc'.eps", as(eps) replace
 31.                         restore
 32.                 }
 33.         }
. }

. 
. 
. ********************************************************************************
. **** (3) Twin predict regressions
. ********************************************************************************
. if `twin'== 1 {
.         local out "$Tables/Twin/`TwinPred'_`births'.xls"
.         fvset base 1 _cou
.         fvset base 1 child_yob
.         
.         eststo: reg twind100 $twinpredict `wt', `se'
. 
.         foreach inc in =="L" !="L"  {
  2.                 eststo: reg twind100 $twinpredict `wt' if inc_status`inc', `se'
  3.         }
.         
.         local cond1 child_yob>1989
.         local cond2 child_yob<=1989
. 
.         foreach condtn in cond1 cond2 {
  2.                 eststo: reg twind100 $twinpredict `wt' if ``condtn'', `se'
  3.         }
. 
.         eststo: reg twind100 $twinpredict /*antenatal*/ prenate* `wt', `se'
. 
.         estout est1 est2 est3 est4 est5 est6 using `out', keep($twinout /*ante**/ pre*) ///
>           title("Probability of Giving Birth to Twins (DHS)") ///
>           varlabels(motherage "Age" motheragesq "Age Squared"  agefirstbirth ///
>           "Age First Birth" educf "Education (years)" educfyrs_sq  ///
>           "Education squared" height "Height" bmi "BMI") `estopt' replace ///
>           note("Notes: All specifications include a full set of year of birth and" ///
>           " country dummies, and are estimated as linear probability models. " ///
>           "Twin is multiplied by 100 for presentation.  Height is measured in cm" ///
>           " and BMI is weight in kg divided by height in metres squared. l" ///
>           " Prenatal care variables are only recoreded for recent births.  As" ///
>           " such, column (6) is estimated only for that subset of births where " ///
>           "these observations are made.")
. 
.         estimates clear
.         
.         *****************************************************************************
.    **** (3a) Non-linear health
.    *****************************************************************************
.         local out "$Tables/Twin/`TwinPred'_alt.xls"
.         fvset base 1 _cou
.         fvset base 1 child_yob
. 
.         eststo: reg twind100 $twinpredict bmi_sq height_sq `wt', `se'
.         foreach inc in =="L" !="L"  {
  2.                 eststo: reg twind100 $twinpredict bmi_sq height_sq `wt' if /*
>                 */ inc_status`inc', `se'
  3.         }
.         estout est1 est2 est3 using `out', ///
>           keep($twinout bmi_sq height_sq) ///
>           title("Probability of Giving Birth to Twins (DHS)") ///
>           varlabels(motherage "Age" motheragesq "Age Squared"  agefirstbirth ///
>           "Age First Birth" educf "Education (years)" educfyrs_sq  ///
>           "Education squared" height "Height" bmi "BMI" bmi_sq "BMI squared" ///
>           height_sq "height squared") `estopt' replace
. 
.         estimates clear
.         
.         *****************************************************************************
.    **** (3b) Z-scores
.    *****************************************************************************
.         local out "$Tables/Twin/`TwinPred'_Z.xls"
.         fvset base 1 _cou
.         fvset base 1 child_yob
.         foreach var of varlist educf height bmi {
  2.                 egen `var'_sd=sd(`var')
  3.                 egen `var'_mean=mean(`var')     
  4.                 gen Z`var'=(`var'-`var'_mean)/`var'_sd
  5.                 drop `var'_sd `var'_mean
  6.         }
. 
.         eststo: reg twind motherage motheragesq agefirstbirth Zeducf Zbmi Zheight /*
>         */ i.child_yob i.bord `wt', `se'
. 
.         drop Zbmi Zheight Zeducf
.         foreach var of varlist educf height bmi {
  2.                 bys _cou: egen `var'_sd=sd(`var')
  3.                 bys _cou: egen `var'_mean=mean(`var')   
  4.                 gen Z`var'=(`var'-`var'_mean)/`var'_sd
  5.                 drop `var'_sd `var'_mean
  6.         }
.         eststo: reg twind motherage motheragesq agefirstbirth Zeducf Zbmi Zheight /*
>         */ i.child_yob i.bord `wt', `se'
.         
.         estout est1 est2 using `out', keep(motherage motheragesq agefirstbirth ///
>           Zeducf Zbmi Zheight) title("Probability of Giving Birth to Twins (DHS)") ///
>           varlabels(motherage "Age" motheragesq "Age Squared"  agefirstbirth ///
>           "Age First Birth" Zeducf "Education (Z-score)" educfyrs_sq  ///
>           "Education squared" height "Height" bmi "BMI" bmi_sq "BMI squared" ///
>           height_sq "height squared") `estopt' replace
.         estimates clear
. }

. 
. ********************************************************************************
. **** (4) Simple OLS of Q-Q (can then apply Altonji)
. ********************************************************************************
. if `ols'==1 {
.         local out "$Tables/OLS/QQ_ols_`births'.xls"
. 
.         gen desiredbirth=bord<=idealnumkids
.         gen fertXdesired=fert*desiredbirth
.         local count = 0
.         foreach y of varlist $outcomes {
  2.                 qui reg `y' fert `base' $age  $S $H [pw=sweight], `se'
  3.                 reg `y' fert `base' $age [pw=sweight] if e(sample)==1, `se'
  4.                 if `count'==0 outreg2 fert $age using `out', replace
  5.                 else if `count'!=0 outreg2 fert $age using `out', append
  6.                 reg `y' fert `base' $age $S [pw=sweight] if e(sample)==1, `se'
  7.                 outreg2 fert $age $S using `out', append
  8.                 reg `y' fert `base' $age $S $H [pw=sweight], `se'
  9.                 outreg2 fert $age $S $H using `out', excel append
 10.                 reg `y' fert fertXdesired `base' $age $S $H [pw=sweight], `se'
 11.                 outreg2 fert* $age $S $H using `out', excel append
 12. 
.                 local ++count
 13.         }
.         
.         foreach inc in low mid {
  2.                 foreach y of varlist $outcomes {
  3.                         qui reg `y' fert `base' $age $S $H if income==`"`inc'"', `se'
  4.                         reg `y' fert `base' $age `wt' if income==`"`inc'"'&e(sample), `se'
  5.                         outreg2 fert $age using `out', excel append
  6. 
.                         reg `y' fert `base' $age $S `wt' if income==`"`inc'"'&e(sample), `se'
  7.                         outreg2 fert $age $S using `out', excel append
  8. 
.                         reg `y' fert `base' $age $S $H `wt' if income==`"`inc'"', `se'
  9.                         outreg2 fert $age $S $H using `out', excel append
 10. 
.                         reg `y' fert fertXdesired `base' $age $S $H `wt' /*
>                         */ if income==`"`inc'"', `se'
 11.                         outreg2 fert* $age $S $H using `out', excel append
 12.                 }
 13.         }
. }

. 
. ********************************************************************************
. **** (5) IV (using twin at order n), subsequent inclusion of twin predictors
. ********************************************************************************
. if `IV'==1 {
.         tokenize `fnames'
.         foreach condition of local conditions {
  2.                 
.                 local n1=1
  3.                 local n2=2
  4.                 local n3=3
  5.                 local estimates
  6.                 local fstage
  7. 
.                 local OUT "$Tables/IV/`1'"
  8. 
.                 foreach n in `gplus' {
  9.                         preserve
 10.                         keep `cond'&`condition'&`n'_plus==1                     
 11. 
.                         foreach y of varlist $outcomes {
 12.                                 eststo: ivreg2 `y' `base' $age $S $H (fert=twin_`n'_fam) `wt',    /*
>                                 */ `se' savefirst savefp(f`n3')
 13.                                 eststo: ivreg2 `y' `base' $age $H (fert=twin_`n'_fam) `wt'        /*
>                                 */ if e(sample), `se' savefirst savefp(f`n2')
 14.                                 eststo: ivreg2 `y' `base' (fert=twin_`n'_fam) `wt' if e(sample),  /*
>                                 */ `se' savefirst savefp(f`n1')
 15. 
.                                 local estimates `estimates'  est`n3' est`n2' est`n1' 
 16.                                 local fstage `fstage' f`n1'fert f`n2'fert f`n3'fert
 17.                                 local n1=`n1'+3
 18.                                 local n2=`n2'+3
 19.                                 local n3=`n3'+3
 20.                         }
 21.                         restore
 22.                 }
 23. 
.                 estout `estimates' using "`OUT'.xls", replace `estopt' `varlab' /*
>                 */ keep(fert $age $S $H)
 24.                 estout `fstage' using "`OUT'_first.xls", replace `estopt' `varlab' /*
>                 */ keep(twin_* $age $S $H)
 25. 
.                 estimates clear
 26.                 macro shift
 27.         }
(3234643 observations deleted)
(sum of wgt is     2.4786e+11)
Warning - collinearities detected
Vars dropped:       _country30 _country41 _country49 _country50 _country52
                    _country57 _country63 _country65 _country66 _country68 _yb1
                    _yb2 _yb3 _yb4 _yb5 _yb6 _yb56 _yb57 _yb58 _yb59 _yb60 _yb61
                    _yb62 _age1 _age2 _age3 _age4 _age5 _age6 _age19 _age20
                    _age21 _age22 _age23 _age24 _age25 _age26 _age27 _age28
                    _age29 _age30 _age31 _age32 _age33 _age34 _age35 _age36
                    _age37 _age38 _age39 _age40 _age41 _age42 _age43 _age44
                    _contracep4 _contracep5

Stored estimation results
-------------------------
---------------------------------------------------------------------------
        name | command      depvar       npar  title 
-------------+-------------------------------------------------------------
      f3fert | ivreg2       fert          133  First-stage regression: fert
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on id

Number of clusters (id) =       249536                Number of obs =   249536
                                                      F(132,249535) = 12868.11
                                                      Prob > F      =   0.0000
Total (centered) SS     =  227504.7498                Centered R2   =   0.1726
Total (uncentered) SS   =  230628.2659                Uncentered R2 =   0.1839
Residual SS             =  188226.7883                Root MSE      =    .8685

-------------------------------------------------------------------------------
              |               Robust
school_zscore |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
--------------+----------------------------------------------------------------
         fert |   -.026371   .0261416    -1.01   0.313    -.0776076    .0248656
        malec |  -.0237293   .0048033    -4.94   0.000    -.0331436   -.0143149
    _country1 |  -.3596484   .0327834   -10.97   0.000    -.4239027   -.2953941
    _country2 |  -.5164591   .0320038   -16.14   0.000    -.5791854   -.4537327
    _country3 |  -.4352985   .0340148   -12.80   0.000    -.5019662   -.3686308
    _country4 |   .4432809   .0258933    17.12   0.000     .3925311    .4940308
    _country5 |   .6288297    .023215    27.09   0.000     .5833291    .6743302
    _country6 |   .0906697   .0205284     4.42   0.000     .0504348    .1309047
    _country7 |   .3227108   .0385533     8.37   0.000     .2471476     .398274
    _country8 |   .5615853    .022015    25.51   0.000     .5184368    .6047338
    _country9 |   .3798848   .0455624     8.34   0.000     .2905841    .4691854
   _country10 |   .4373855   .0232278    18.83   0.000       .39186    .4829111
   _country11 |   .2067806   .0316536     6.53   0.000     .1447407    .2688204
   _country12 |   .5788677   .0444582    13.02   0.000     .4917312    .6660042
   _country13 |   .5748467   .0294469    19.52   0.000     .5171317    .6325616
   _country14 |  -.0426347   .0228431    -1.87   0.062    -.0874064    .0021369
   _country15 |   .5304389   .0782193     6.78   0.000     .3771319     .683746
   _country16 |   .1248066   .0389773     3.20   0.001     .0484126    .2012007
   _country17 |   .3010189   .0518813     5.80   0.000     .1993334    .4027044
   _country18 |   .5477578   .0327256    16.74   0.000     .4836168    .6118987
   _country19 |  -.0838841   .0308473    -2.72   0.007    -.1443437   -.0234245
   _country20 |   .0511917   .0182853     2.80   0.005     .0153532    .0870302
   _country21 |   .5695075   .0255102    22.32   0.000     .5195084    .6195067
   _country22 |   .2494059   .0475629     5.24   0.000     .1561843    .3426274
   _country23 |    .227627   .0253325     8.99   0.000     .1779762    .2772778
   _country24 |    .579084   .0339822    17.04   0.000       .51248     .645688
   _country25 |     .59609   .0321126    18.56   0.000     .5331506    .6590295
   _country26 |  -.4281329   .0416145   -10.29   0.000    -.5096958   -.3465701
   _country27 |   .4686738    .028379    16.51   0.000      .413052    .5242956
   _country28 |   .1242822   .0207328     5.99   0.000     .0836467    .1649178
   _country29 |      .3978   .0238691    16.67   0.000     .3510175    .4445826
   _country31 |  -.0951366   .0432901    -2.20   0.028    -.1799837   -.0102895
   _country32 |  -.2471743   .0417799    -5.92   0.000    -.3290613   -.1652872
   _country33 |   .2102218   .0276654     7.60   0.000     .1559986     .264445
   _country34 |  -.2710334   .0400329    -6.77   0.000    -.3494965   -.1925703
   _country35 |   -.047357   .0334353    -1.42   0.157     -.112889     .018175
   _country36 |    .380919   .0392374     9.71   0.000     .3040151     .457823
   _country37 |   .4792914    .026213    18.28   0.000      .427915    .5306678
   _country38 |   .2474586    .023186    10.67   0.000     .2020149    .2929023
   _country39 |   .1415982   .0368697     3.84   0.000     .0693349    .2138616
   _country40 |   .6796616   .0277938    24.45   0.000     .6251867    .7341365
   _country42 |   .5020819   .0225021    22.31   0.000     .4579787    .5461851
   _country43 |    .378559   .0246518    15.36   0.000     .3302423    .4268757
   _country44 |   .0388755   .0319625     1.22   0.224    -.0237699    .1015208
   _country45 |   .4439475   .0254798    17.42   0.000      .394008    .4938869
   _country46 |   .3780257   .0227957    16.58   0.000      .333347    .4227043
   _country47 |    .577323   .0307418    18.78   0.000     .5170701    .6375759
   _country48 |   .3289376    .030533    10.77   0.000      .269094    .3887812
   _country51 |   .1815552   .0204452     8.88   0.000     .1414833    .2216271
   _country53 |   .1741435    .027866     6.25   0.000     .1195272    .2287597
   _country54 |   .1355615    .056883     2.38   0.017     .0240729    .2470501
   _country55 |   .5706896   .0316411    18.04   0.000     .5086741    .6327051
   _country56 |    .403914   .0492034     8.21   0.000      .307477    .5003509
   _country58 |   -.134318   .0470143    -2.86   0.004    -.2264643   -.0421717
   _country59 |   .2603929   .0253522    10.27   0.000     .2107036    .3100822
   _country60 |   .5377465   .0470949    11.42   0.000     .4454422    .6300509
   _country61 |   .1331333   .0259511     5.13   0.000     .0822702    .1839965
   _country62 |   .3442674   .0361054     9.54   0.000     .2735021    .4150327
   _country64 |  -.2778347   .0380702    -7.30   0.000     -.352451   -.2032184
   _country67 |   .2951819   .0260986    11.31   0.000     .2440296    .3463342
         _yb7 |  -2.863709   .5048535    -5.67   0.000    -3.853203   -1.874214
         _yb8 |  -1.711948   .7275791    -2.35   0.019    -3.137976   -.2859188
         _yb9 |  -.2138247   .6692701    -0.32   0.749     -1.52557    1.097921
        _yb10 |  -1.232525   .5684958    -2.17   0.030    -2.346757   -.1182942
        _yb11 |  -.8025106   .5340336    -1.50   0.133    -1.849197    .2441761
        _yb12 |   -1.11441   .4998767    -2.23   0.026     -2.09415   -.1346692
        _yb13 |  -.9940728   .4854107    -2.05   0.041     -1.94546   -.0426853
        _yb14 |  -1.095047   .4863656    -2.25   0.024    -2.048306    -.141788
        _yb15 |  -1.059055   .4808253    -2.20   0.028    -2.001456   -.1166551
        _yb16 |  -.8865221   .4789061    -1.85   0.064    -1.825161    .0521167
        _yb17 |  -.8691969   .4765694    -1.82   0.068    -1.803256     .064862
        _yb18 |  -.9299916   .4757874    -1.95   0.051    -1.862518    .0025346
        _yb19 |  -.8814975   .4744497    -1.86   0.063    -1.811402    .0484067
        _yb20 |  -.8612096   .4743604    -1.82   0.069    -1.790939    .0685198
        _yb21 |  -.8768362   .4739742    -1.85   0.064    -1.805809    .0521362
        _yb22 |  -.8657872    .473627    -1.83   0.068    -1.794079    .0625047
        _yb23 |  -.8021206   .4727478    -1.70   0.090    -1.728689     .124448
        _yb24 |  -.8158502   .4724491    -1.73   0.084    -1.741833    .1101329
        _yb25 |  -.8389923   .4722536    -1.78   0.076    -1.764592    .0866078
        _yb26 |  -.8322148   .4721226    -1.76   0.078    -1.757558    .0931285
        _yb27 |   -.798574   .4719411    -1.69   0.091    -1.723561    .1264136
        _yb28 |  -.7798781    .471659    -1.65   0.098    -1.704313    .1445565
        _yb29 |  -.7788893   .4713657    -1.65   0.098    -1.702749    .1449705
        _yb30 |  -.7996159   .4712767    -1.70   0.090    -1.723301    .1240694
        _yb31 |  -.7789997   .4711597    -1.65   0.098    -1.702456    .1444564
        _yb32 |  -.7549079   .4709734    -1.60   0.109    -1.677999     .168183
        _yb33 |  -.7805345   .4708801    -1.66   0.097    -1.703443    .1423736
        _yb34 |  -.7407011   .4707492    -1.57   0.116    -1.663353    .1819503
        _yb35 |  -.7349235   .4706699    -1.56   0.118     -1.65742    .1875727
        _yb36 |  -.7212311   .4706107    -1.53   0.125    -1.643611    .2011489
        _yb37 |  -.6984742   .4705257    -1.48   0.138    -1.620688    .2237392
        _yb38 |  -.7015857   .4705007    -1.49   0.136     -1.62375    .2205787
        _yb39 |  -.6600645   .4703831    -1.40   0.161    -1.581999    .2618695
        _yb40 |  -.6583872   .4702879    -1.40   0.162    -1.580135    .2633601
        _yb41 |  -.6458113   .4703167    -1.37   0.170    -1.567615    .2759925
        _yb42 |  -.6547942   .4702011    -1.39   0.164    -1.576371    .2667829
        _yb43 |  -.6513524   .4701351    -1.39   0.166      -1.5728    .2700954
        _yb44 |  -.6165502   .4701131    -1.31   0.190    -1.537955    .3048545
        _yb45 |  -.6210042   .4700271    -1.32   0.186     -1.54224    .3002319
        _yb46 |  -.6418641   .4699857    -1.37   0.172    -1.563019     .279291
        _yb47 |  -.6085111     .46992    -1.29   0.195    -1.529537    .3125152
        _yb48 |  -.5996382   .4698714    -1.28   0.202    -1.520569    .3212928
        _yb49 |  -.6287909   .4700295    -1.34   0.181    -1.550032      .29245
        _yb50 |   -.642179   .4703328    -1.37   0.172    -1.564014    .2796563
        _yb51 |  -.6519173    .470294    -1.39   0.166    -1.573677     .269842
        _yb52 |  -.6781094   .4709666    -1.44   0.150    -1.601187    .2449682
        _yb53 |  -.7545462   .4715587    -1.60   0.110    -1.678784    .1696918
        _yb54 |  -.7334599   .4782336    -1.53   0.125    -1.670781    .2038608
        _yb55 |  -.8639788   .4736747    -1.82   0.068    -1.792364    .0644066
        _age7 |  -.3333659   .0450045    -7.41   0.000    -.4215732   -.2451587
        _age8 |  -.2656697   .0402869    -6.59   0.000    -.3446305   -.1867089
        _age9 |  -.2171545   .0352045    -6.17   0.000    -.2861541    -.148155
       _age10 |  -.1997695   .0309505    -6.45   0.000    -.2604314   -.1391075
       _age11 |  -.1578696   .0262631    -6.01   0.000    -.2093442    -.106395
       _age12 |  -.1595364   .0234227    -6.81   0.000     -.205444   -.1136289
       _age13 |  -.1125129   .0195119    -5.77   0.000    -.1507555   -.0742703
       _age14 |  -.1028461   .0172903    -5.95   0.000    -.1367344   -.0689578
       _age15 |  -.0791103    .014734    -5.37   0.000    -.1079885   -.0502322
       _age16 |  -.0539105   .0138798    -3.88   0.000    -.0811144   -.0267067
       _age17 |  -.0586016   .0129473    -4.53   0.000    -.0839779   -.0332253
       _age18 |  -.0539453   .0126538    -4.26   0.000    -.0787462   -.0291444
  _contracep1 |   .2154486   .0069223    31.12   0.000     .2018812    .2290161
  _contracep2 |   .1683051    .009765    17.24   0.000     .1491661    .1874441
  _contracep3 |   .0639772   .0117784     5.43   0.000      .040892    .0870625
    motherage |   .0044647   .0271897     0.16   0.870    -.0488262    .0577556
  motheragesq |     .00496   .0011697     4.24   0.000     .0026674    .0072525
 motheragecub |  -.0000799   .0000162    -4.93   0.000    -.0001117   -.0000481
agefirstbirth |  -.0776004    .004747   -16.35   0.000    -.0869044   -.0682964
        educf |   .1170555   .0028974    40.40   0.000     .1113766    .1227343
  educfyrs_sq |  -.0039655   .0001062   -37.33   0.000    -.0041737   -.0037573
       height |   .0044619   .0003695    12.08   0.000     .0037378    .0051861
          bmi |   .0163111   .0007286    22.39   0.000      .014883    .0177392
        _cons |  -.7047448   .4986134    -1.41   0.158    -1.682009    .2725196
-------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            598.831
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1187.779
                         (Kleibergen-Paap rk Wald F statistic):        850.092
Stock-Yogo weak ID test critical values: 10% maximal IV size             16.38
                                         15% maximal IV size              8.96
                                         20% maximal IV size              6.66
                                         25% maximal IV size              5.53
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Warning: estimated covariance matrix of moment conditions not of full rank.
         model tests should be interpreted with caution.
Possible causes:
         number of clusters insufficient to calculate robust covariance matrix
         singleton dummy variable (dummy with one 1 and N-1 0s or vice versa)
partial option may address problem.
------------------------------------------------------------------------------
Instrumented:         fert
Included instruments: malec _country1 _country2 _country3 _country4 _country5
                      _country6 _country7 _country8 _country9 _country10
                      _country11 _country12 _country13 _country14 _country15
                      _country16 _country17 _country18 _country19 _country20
                      _country21 _country22 _country23 _country24 _country25
                      _country26 _country27 _country28 _country29 _country31
                      _country32 _country33 _country34 _country35 _country36
                      _country37 _country38 _country39 _country40 _country42
                      _country43 _country44 _country45 _country46 _country47
                      _country48 _country51 _country53 _country54 _country55
                      _country56 _country58 _country59 _country60 _country61
                      _country62 _country64 _country67 _yb7 _yb8 _yb9 _yb10
                      _yb11 _yb12 _yb13 _yb14 _yb15 _yb16 _yb17 _yb18 _yb19
                      _yb20 _yb21 _yb22 _yb23 _yb24 _yb25 _yb26 _yb27 _yb28
                      _yb29 _yb30 _yb31 _yb32 _yb33 _yb34 _yb35 _yb36 _yb37
                      _yb38 _yb39 _yb40 _yb41 _yb42 _yb43 _yb44 _yb45 _yb46
                      _yb47 _yb48 _yb49 _yb50 _yb51 _yb52 _yb53 _yb54 _yb55
                      _age7 _age8 _age9 _age10 _age11 _age12 _age13 _age14
                      _age15 _age16 _age17 _age18 _contracep1 _contracep2
                      _contracep3 motherage motheragesq motheragecub
                      agefirstbirth educf educfyrs_sq height bmi
Excluded instruments: twin_two_fam
Dropped collinear:    _country30 _country41 _country49 _country50 _country52
                      _country57 _country63 _country65 _country66 _country68
                      _yb1 _yb2 _yb3 _yb4 _yb5 _yb6 _yb56 _yb57 _yb58 _yb59
                      _yb60 _yb61 _yb62 _age1 _age2 _age3 _age4 _age5 _age6
                      _age19 _age20 _age21 _age22 _age23 _age24 _age25 _age26
                      _age27 _age28 _age29 _age30 _age31 _age32 _age33 _age34
                      _age35 _age36 _age37 _age38 _age39 _age40 _age41 _age42
                      _age43 _age44 _contracep4 _contracep5
------------------------------------------------------------------------------
(est1 stored)
(sum of wgt is     2.4786e+11)
Warning - collinearities detected
Vars dropped:       _country30 _country41 _country49 _country50 _country52
                    _country57 _country63 _country65 _country66 _country68 _yb1
                    _yb2 _yb3 _yb4 _yb5 _yb6 _yb56 _yb57 _yb58 _yb59 _yb60 _yb61
                    _yb62 _age1 _age2 _age3 _age4 _age5 _age6 _age19 _age20
                    _age21 _age22 _age23 _age24 _age25 _age26 _age27 _age28
                    _age29 _age30 _age31 _age32 _age33 _age34 _age35 _age36
                    _age37 _age38 _age39 _age40 _age41 _age42 _age43 _age44
                    _contracep4 _contracep5

Stored estimation results
-------------------------
---------------------------------------------------------------------------
        name | command      depvar       npar  title 
-------------+-------------------------------------------------------------
      f2fert | ivreg2       fert          131  First-stage regression: fert
---------------------------------------------------------------------------

IV (2SLS) estimation
--------------------

Estimates efficient for homoskedasticity only
Statistics robust to heteroskedasticity and clustering on id

Number of clusters (id) =       249536                Number of obs =   249536
                                                      F(130,249535) = 11373.18
                                                      Prob > F      =   0.0000
Total (centered) SS     =  227504.7498                Centered R2   =   0.1000
Total (uncentered) SS   =  230628.2659                Uncentered R2 =   0.1122
Residual SS             =  204755.9644                Root MSE      =    .9058

-------------------------------------------------------------------------------
              |               Robust
school_zscore |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
--------------+----------------------------------------------------------------
         fert |  -.0258035   .0269679    -0.96   0.339    -.0786596    .0270525
        malec |  -.0295321    .004922    -6.00   0.000    -.0391791   -.0198851
    _country1 |   -.338356   .0338329   -10.00   0.000    -.4046672   -.2720448
    _country2 |  -.4042319   .0358043   -11.29   0.000    -.4744071   -.3340568
    _country3 |  -.3542755   .0361304    -9.81   0.000    -.4250899   -.2834611
    _country4 |   .2476601   .0233771    10.59   0.000     .2018418    .2934783
    _country5 |   .1962696   .0293167     6.69   0.000       .13881    .2537293
    _country6 |   .0177786    .021539     0.83   0.409    -.0244371    .0599943
    _country7 |   .1968279   .0391887     5.02   0.000     .1200194    .2736364
    _country8 |   .0846843   .0273209     3.10   0.002     .0311364    .1382322
    _country9 |   .0217128   .0521445     0.42   0.677    -.0804885    .1239142
   _country10 |   .2033736    .023223     8.76   0.000     .1578573    .2488899
   _country11 |   .0454505   .0364575     1.25   0.213    -.0260049    .1169058
   _country12 |   .2769327   .0499924     5.54   0.000     .1789494     .374916
   _country13 |   .1373701   .0369871     3.71   0.000     .0648767    .2098635
   _country14 |  -.0956138   .0227724    -4.20   0.000    -.1402469   -.0509808
   _country15 |   .1631021   .0848736     1.92   0.055    -.0032471    .3294513
   _country16 |   .0809984   .0410775     1.97   0.049      .000488    .1615088
   _country17 |   .1787104   .0560198     3.19   0.001     .0689136    .2885072
   _country18 |   .1668298   .0367789     4.54   0.000     .0947445    .2389152
   _country19 |  -.0925741   .0328508    -2.82   0.005    -.1569605   -.0281878
   _country20 |  -.2092828   .0208438   -10.04   0.000     -.250136   -.1684296
   _country21 |   .1565321   .0321043     4.88   0.000     .0936088    .2194555
   _country22 |   .2195772   .0495101     4.44   0.000     .1225393    .3166151
   _country23 |   .0438294    .026997     1.62   0.104    -.0090838    .0967425
   _country24 |   .3680446   .0378172     9.73   0.000     .2939242    .4421651
   _country25 |   .1538931   .0356077     4.32   0.000     .0841033    .2236829
   _country26 |  -.4204866   .0421012    -9.99   0.000    -.5030035   -.3379698
   _country27 |   .1678041   .0324264     5.17   0.000     .1042496    .2313586
   _country28 |  -.0160687   .0205879    -0.78   0.435    -.0564204    .0242829
   _country29 |   .1730045   .0210079     8.24   0.000     .1318299    .2141792
   _country31 |  -.0679708   .0427844    -1.59   0.112    -.1518267    .0158851
   _country32 |  -.1038979   .0457769    -2.27   0.023    -.1936191   -.0141768
   _country33 |    .187469   .0289921     6.47   0.000     .1306456    .2442924
   _country34 |   -.104726   .0416213    -2.52   0.012    -.1863022   -.0231498
   _country35 |  -.0922078   .0344397    -2.68   0.007    -.1597083   -.0247073
   _country36 |   .0931283   .0422125     2.21   0.027     .0103932    .1758633
   _country37 |   .3293724   .0294777    11.17   0.000     .2715973    .3871476
   _country38 |   .0394771   .0269286     1.47   0.143    -.0133021    .0922563
   _country39 |   .0565087    .035698     1.58   0.113     -.013458    .1264754
   _country40 |   .2258824   .0359594     6.28   0.000     .1554033    .2963616
   _country42 |   .0530386   .0233564     2.27   0.023     .0072609    .0988163
   _country43 |   .0683205    .029111     2.35   0.019     .0112639    .1253771
   _country44 |  -.0061544   .0333596    -0.18   0.854    -.0715379    .0592292
   _country45 |   .0798558   .0224173     3.56   0.000     .0359188    .1237929
   _country46 |   .2707887   .0233825    11.58   0.000     .2249598    .3166176
   _country47 |   .1613982   .0367939     4.39   0.000     .0892835    .2335129
   _country48 |   .1608614   .0348347     4.62   0.000     .0925866    .2291361
   _country51 |   .1755988    .021238     8.27   0.000     .1339731    .2172245
   _country53 |  -.0692733   .0336971    -2.06   0.040    -.1353184   -.0032283
   _country54 |  -.0242527   .0602403    -0.40   0.687    -.1423216    .0938162
   _country55 |   .1589473   .0386402     4.11   0.000     .0832139    .2346807
   _country56 |  -.0319865   .0507448    -0.63   0.528    -.1314444    .0674715
   _country58 |  -.1494257    .047903    -3.12   0.002    -.2433139   -.0555375
   _country59 |   .1482027   .0275725     5.38   0.000     .0941616    .2022438
   _country60 |   .1582788   .0529042     2.99   0.003     .0545884    .2619691
   _country61 |  -.1208071   .0272191    -4.44   0.000    -.1741555   -.0674586
   _country62 |   .1636518   .0410673     3.98   0.000     .0831613    .2441422
   _country64 |   -.103147    .038748    -2.66   0.008    -.1790917   -.0272023
   _country67 |   .2450501   .0280646     8.73   0.000     .1900446    .3000557
         _yb7 |  -3.518915   .5138708    -6.85   0.000    -4.526083   -2.511747
         _yb8 |  -2.191684   .7533974    -2.91   0.004    -3.668315   -.7150518
         _yb9 |  -.4125952   .6509038    -0.63   0.526    -1.688343    .8631527
        _yb10 |  -1.770289   .5646175    -3.14   0.002    -2.876919   -.6636589
        _yb11 |  -1.165947   .5406471    -2.16   0.031    -2.225595   -.1062979
        _yb12 |  -1.366359   .5012345    -2.73   0.006    -2.348761   -.3839575
        _yb13 |  -1.244432    .489808    -2.54   0.011    -2.204438   -.2844256
        _yb14 |  -1.362011   .4902406    -2.78   0.005    -2.322865   -.4011573
        _yb15 |  -1.282561   .4831613    -2.65   0.008     -2.22954   -.3355826
        _yb16 |  -1.117968   .4810335    -2.32   0.020    -2.060776   -.1751593
        _yb17 |   -1.09368   .4778441    -2.29   0.022    -2.030237   -.1571225
        _yb18 |  -1.127982   .4769663    -2.36   0.018    -2.062819   -.1931456
        _yb19 |  -1.061074   .4752289    -2.23   0.026    -1.992506   -.1296427
        _yb20 |  -1.040872   .4751593    -2.19   0.028    -1.972167   -.1095764
        _yb21 |  -1.032946    .474614    -2.18   0.030    -1.963172   -.1027191
        _yb22 |  -1.021931   .4741645    -2.16   0.031    -1.951276   -.0925856
        _yb23 |   -.942221   .4731369    -1.99   0.046    -1.869552   -.0148898
        _yb24 |  -.9377397    .472689    -1.98   0.047    -1.864193   -.0112863
        _yb25 |  -.9754659   .4725734    -2.06   0.039    -1.901693   -.0492391
        _yb26 |  -.9463125   .4723224    -2.00   0.045    -1.872047   -.0205776
        _yb27 |  -.9093823   .4720922    -1.93   0.054    -1.834666    .0159015
        _yb28 |   -.887966   .4717726    -1.88   0.060    -1.812623    .0366914
        _yb29 |  -.8806679   .4714288    -1.87   0.062    -1.804651    .0433155
        _yb30 |  -.8916493   .4713039    -1.89   0.059    -1.815388    .0320893
        _yb31 |  -.8626409   .4711512    -1.83   0.067     -1.78608    .0607985
        _yb32 |  -.8362718   .4709287    -1.78   0.076    -1.759275    .0867315
        _yb33 |  -.8504302   .4708096    -1.81   0.071      -1.7732    .0723397
        _yb34 |   -.807972   .4706562    -1.72   0.086    -1.730441    .1144972
        _yb35 |  -.8084562   .4705844    -1.72   0.086    -1.730785    .1138722
        _yb36 |  -.7844411   .4704891    -1.67   0.095    -1.706583    .1377007
        _yb37 |   -.750854   .4703731    -1.60   0.110    -1.672768    .1710604
        _yb38 |  -.7583118   .4703565    -1.61   0.107    -1.680194    .1635701
        _yb39 |  -.7092506   .4702111    -1.51   0.131    -1.630847    .2123462
        _yb40 |   -.702823   .4700935    -1.50   0.135    -1.624189    .2185433
        _yb41 |  -.6855321   .4701157    -1.46   0.145    -1.606942    .2358777
        _yb42 |  -.6867619   .4699814    -1.46   0.144    -1.607909    .2343848
        _yb43 |  -.6899581   .4699296    -1.47   0.142    -1.611003     .231087
        _yb44 |  -.6312846   .4698582    -1.34   0.179     -1.55219    .2896206
        _yb45 |  -.6558523   .4697995    -1.40   0.163    -1.576642    .2649378
        _yb46 |  -.6632713   .4697337    -1.41   0.158    -1.583933    .2573898
        _yb47 |  -.6220983   .4696633    -1.32   0.185    -1.542622    .2984249
        _yb48 |  -.6138175   .4695858    -1.31   0.191    -1.534189    .3065537
        _yb49 |  -.6189828   .4697053    -1.32   0.188    -1.539588    .3016227
        _yb50 |  -.6179486   .4699709    -1.31   0.189    -1.539075    .3031773
        _yb51 |  -.6335338   .4699596    -1.35   0.178    -1.554638      .28757
        _yb52 |  -.6292881   .4705176    -1.34   0.181    -1.551486    .2929095
        _yb53 |  -.6870308   .4712248    -1.46   0.145    -1.610614    .2365528
        _yb54 |  -.6169224   .4773551    -1.29   0.196    -1.552521    .3186764
        _yb55 |  -.8294488   .4730607    -1.75   0.080    -1.756631    .0977332
        _age7 |  -.3116808   .0469046    -6.64   0.000     -.403612   -.2197495
        _age8 |  -.2500667   .0419277    -5.96   0.000    -.3322434     -.16789
        _age9 |  -.2044545   .0366123    -5.58   0.000    -.2762134   -.1326957
       _age10 |  -.1810459   .0324419    -5.58   0.000    -.2446308    -.117461
       _age11 |  -.1579291   .0271752    -5.81   0.000    -.2111916   -.1046666
       _age12 |   -.148085   .0245489    -6.03   0.000    -.1961999   -.0999701
       _age13 |  -.1170135   .0202347    -5.78   0.000    -.1566727   -.0773543
       _age14 |  -.1058276   .0180149    -5.87   0.000    -.1411361   -.0705191
       _age15 |  -.0741111   .0155963    -4.75   0.000    -.1046792   -.0435429
       _age16 |  -.0507277   .0147551    -3.44   0.001    -.0796471   -.0218082
       _age17 |  -.0596002    .013816    -4.31   0.000     -.086679   -.0325213
       _age18 |  -.0391934   .0136846    -2.86   0.004    -.0660147   -.0123721
  _contracep1 |    .352196   .0071454    49.29   0.000     .3381914    .3662006
  _contracep2 |   .2956181   .0092626    31.92   0.000     .2774638    .3137725
  _contracep3 |    .118521   .0109613    10.81   0.000     .0970374    .1400047
    motherage |  -.0049243    .029645    -0.17   0.868    -.0630274    .0531789
  motheragesq |   .0065616   .0012902     5.09   0.000     .0040328    .0090904
 motheragecub |  -.0001154    .000018    -6.39   0.000    -.0001507     -.00008
agefirstbirth |  -.0648468   .0051747   -12.53   0.000     -.074989   -.0547046
       height |   .0102251   .0004698    21.76   0.000     .0093042     .011146
          bmi |   .0286271   .0010389    27.55   0.000     .0265909    .0306633
        _cons |  -1.749985   .5046077    -3.47   0.001    -2.738998   -.7609725
-------------------------------------------------------------------------------
Underidentification test (Kleibergen-Paap rk LM statistic):            572.692
                                                   Chi-sq(1) P-val =    0.0000
------------------------------------------------------------------------------
Weak identification test (Cragg-Donald Wald F statistic):             1116.777
                         (Kleibergen-Paap rk Wald F statistic):        789.382
Stock-Yogo weak ID test critical values: 10% maximal IV size             16.38
                                         15% maximal IV size              8.96
                                         20% maximal IV size              6.66
                                         25% maximal IV size              5.53
Source: Stock-Yogo (2005).  Reproduced by permission.
NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.
------------------------------------------------------------------------------
Warning: estimated covariance matrix of moment conditions not of full rank.
         model tests should be interpreted with caution.
Possible causes:
         number of clusters insufficient to calculate robust covariance matrix
         singleton dummy variable (dummy with one 1 and N-1 0s or vice versa)
partial option may address problem.
------------------------------------------------------------------------------
Instrumented:         fert
Included instruments: malec _country1 _country2 _country3 _country4 _country5
                      _country6 _country7 _country8 _country9 _country10
                      _country11 _country12 _country13 _country14 _country15
                      _country16 _country17 _country18 _country19 _country20
                      _country21 _country22 _country23 _country24 _country25
                      _country26 _country27 _country28 _country29 _country31
                      _country32 _country33 _country34 _country35 _country36
                      _country37 _country38 _country39 _country40 _country42
                      _country43 _country44 _country45 _country46 _country47
                      _country48 _country51 _country53 _country54 _country55
                      _country56 _country58 _country59 _country60 _country61
                      _country62 _country64 _country67 _yb7 _yb8 _yb9 _yb10
                      _yb11 _yb12 _yb13 _yb14 _yb15 _yb16 _yb17 _yb18 _yb19
                      _yb20 _yb21 _yb22 _yb23 _yb24 _yb25 _yb26 _yb27 _yb28
                      _yb29 _yb30 _yb31 _yb32 _yb33 _yb34 _yb35 _yb36 _yb37
                      _yb38 _yb39 _yb40 _yb41 _yb42 _yb43 _yb44 _yb45 _yb46
                      _yb47 _yb48 _yb49 _yb50 _yb51 _yb52 _yb53 _yb54 _yb55
                      _age7 _age8 _age9 _age10 _age11 _age12 _age13 _age14
                      _age15 _age16 _age17 _age18 _contracep1 _contracep2
                      _contracep3 motherage motheragesq motheragecub
                      agefirstbirth height bmi
Excluded instruments: twin_two_fam
Dropped collinear:    _country30 _country41 _country49 _country50 _country52
                      _country57 _country63 _country65 _country66 _country68
                      _yb1 _yb2 _yb3 _yb4 _yb5 _yb6 _yb56 _yb57 _yb58 _yb59
                      _yb60 _yb61 _yb62 _age1 _age2 _age3 _age4 _age5 _age6
                      _age19 _age20 _age21 _age22 _age23 _age24 _age25 _age26
                      _age27 _age28 _age29 _age30 _age31 _age32 _age33 _age34
                      _age35 _age36 _age37 _age38 _age39 _age40 _age41 _age42
                      _age43 _age44 _contracep4 _contracep5
------------------------------------------------------------------------------
(est2 stored)
(sum of wgt is     2.4786e+11)
